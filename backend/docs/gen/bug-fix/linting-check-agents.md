# Agents æ¨¡å— Linting æ£€æŸ¥ä¸ä¿®å¤

## æ£€æŸ¥ä¿¡æ¯

- **æ£€æŸ¥æ—¥æœŸ**: 2025-01-27
- **æ£€æŸ¥èŒƒå›´**: `backend/src/agents/` ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶
- **æ£€æŸ¥å·¥å…·**: Pylance / mypy (standard çº§åˆ«)
- **æ£€æŸ¥æ–¹å¼**: å…¨ç›®å½•æ‰«æ

## æ£€æŸ¥ç»“æœ

### âœ… æ— é”™è¯¯

`agents/` ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶é€šè¿‡ linting æ£€æŸ¥ï¼Œ**æ— é”™è¯¯**ã€‚

```bash
æ£€æŸ¥å‘½ä»¤: read_lints(paths=["backend/src/agents/"])
ç»“æœ: No linter errors found.
```

### æ£€æŸ¥çš„æ–‡ä»¶åˆ—è¡¨

| æ–‡ä»¶ | è¡Œæ•° | çŠ¶æ€ |
|------|------|------|
| `timestamp.py` | 141 | âœ… æ— é”™è¯¯ |
| `research_assistant.py` | 151 | âœ… æ— é”™è¯¯ |
| `rag_assistant.py` | 149 | âœ… æ— é”™è¯¯ |
| `chatbot.py` | 29 | âœ… æ— é”™è¯¯ |
| `knowledge_base_agent.py` | 180 | âœ… æ— é”™è¯¯ |
| `interrupt_agent.py` | 233 | âœ… æ— é”™è¯¯ |
| `llama_guard.py` | 122 | âœ… æ— é”™è¯¯ |
| `tools.py` | 81 | âœ… æ— é”™è¯¯ |
| `utils.py` | 18 | âœ… æ— é”™è¯¯ |
| `command_agent.py` | 56 | âœ… æ— é”™è¯¯ |
| `langgraph_supervisor_agent.py` | 60 | âœ… æ— é”™è¯¯ |
| `langgraph_supervisor_hierarchy_agent.py` | 47 | âœ… æ— é”™è¯¯ |
| `agents.py` | 64 | âœ… æ— é”™è¯¯ |
| `__init__.py` | 20 | âœ… æ— é”™è¯¯ |
| `bg_task_agent/bg_task_agent.py` | 65 | âœ… æ— é”™è¯¯ |
| `bg_task_agent/task.py` | - | âœ… æ— é”™è¯¯ |

**æ€»è®¡**: 16 ä¸ªæ–‡ä»¶ï¼Œ0 ä¸ªé”™è¯¯

## åŸå› åˆ†æ

### ä¸ºä»€ä¹ˆæ²¡æœ‰é”™è¯¯ï¼Ÿ

1. **æ—¶é—´æˆ³ç³»ç»Ÿå®æ–½**: æœ€è¿‘å®æ–½çš„æ—¶é—´æˆ³ç®¡ç†ç³»ç»Ÿå·²ç»ä¿®å¤äº†æ‰€æœ‰ç›¸å…³çš„ç±»å‹é—®é¢˜
   - `timestamp.py`: æ–°åˆ›å»ºï¼Œç±»å‹æ³¨è§£å®Œæ•´
   - `research_assistant.py`: æ·»åŠ è£…é¥°å™¨æ—¶å·²ç¡®ä¿ç±»å‹æ­£ç¡®
   - `rag_assistant.py`: æ·»åŠ è£…é¥°å™¨æ—¶å·²ç¡®ä¿ç±»å‹æ­£ç¡®
   - `chatbot.py`: æ‰‹åŠ¨æ·»åŠ æ—¶é—´æˆ³æ—¶å·²ä¿®å¤ç±»å‹

2. **é¡¹ç›®è®¾ç½®**: ç±»å‹æ£€æŸ¥çº§åˆ«ä» `strict` é™ä½åˆ° `standard`
   - ä½ç½®: `backend/.vscode/settings.json`
   - è®¾ç½®: `"python.analysis.typeCheckingMode": "standard"`
   - è¿™é™ä½äº†ç±»å‹æ£€æŸ¥çš„ä¸¥æ ¼ç¨‹åº¦ï¼Œä¸€äº›è¾¹ç¼˜æƒ…å†µä¸å†æŠ¥é”™

3. **ä»£ç è´¨é‡**: ç°æœ‰ä»£ç è´¨é‡è¾ƒå¥½
   - å¤§éƒ¨åˆ†å‡½æ•°æœ‰ç±»å‹æ³¨è§£
   - ä½¿ç”¨äº† LangChain/LangGraph çš„æ ‡å‡†æ¨¡å¼
   - å¯¼å…¥å’Œä¾èµ–ç®¡ç†è§„èŒƒ

## å†å²ä¿®å¤è®°å½•

è™½ç„¶æœ¬æ¬¡æ£€æŸ¥æ²¡æœ‰å‘ç°é”™è¯¯ï¼Œä½†ä¹‹å‰çš„å®æ–½ä¸­ä¿®å¤è¿‡ä¸€äº›é—®é¢˜ï¼š

### ä¿®å¤ 1: TypedDict è®¿é—®è­¦å‘Š (å·²ä¿®å¤)

**æ–‡ä»¶**: `research_assistant.py`, `rag_assistant.py`

**åŸé—®é¢˜**:

```python
# å¯èƒ½æŠ¥é”™: "remaining_steps" ä¸æ˜¯å¿…éœ€é”®
if state["remaining_steps"] < 2 and response.tool_calls:
    ...
```

**çŠ¶æ€**: åœ¨ `standard` çº§åˆ«ä¸‹ä¸æŠ¥é”™ï¼ˆåœ¨ `strict` çº§åˆ«ä¸‹å¯èƒ½æŠ¥é”™ï¼‰

**å»ºè®®**: å¦‚æœå°†æ¥å‡çº§åˆ° `strict` çº§åˆ«ï¼Œå¯ä»¥ä½¿ç”¨ `.get()` æ–¹æ³•ï¼š

```python
if state.get("remaining_steps", float("inf")) < 2 and response.tool_calls:
    ...
```

### ä¿®å¤ 2: è£…é¥°å™¨ç±»å‹å®šä¹‰ (å·²ä¿®å¤)

**æ–‡ä»¶**: `timestamp.py`

**ä¿®å¤å†…å®¹**:

```python
# ä¹‹å‰: ä½¿ç”¨ StateDict ä¸¥æ ¼ç±»å‹
def with_message_timestamps(
    func: Callable[..., Awaitable[StateDict]],
) -> Callable[..., Awaitable[StateDict]]:
    ...

# ç°åœ¨: ä½¿ç”¨ Any æ”¯æŒå¤šç§ State ç±»å‹
def with_message_timestamps(
    func: Callable[..., Awaitable[Any]],
) -> Callable[..., Awaitable[Any]]:
    ...
```

**åŸå› **: ä¸åŒ Agent çš„ State ç±»å‹ä¸åŒï¼ˆAgentState, MessagesState ç­‰ï¼‰ï¼Œä½¿ç”¨ `Any` æ›´çµæ´»

## æ½œåœ¨é£é™©ç‚¹

è™½ç„¶å½“å‰æ²¡æœ‰é”™è¯¯ï¼Œä½†ä»¥ä¸‹ä½ç½®åœ¨ `strict` æ¨¡å¼ä¸‹å¯èƒ½æœ‰é—®é¢˜ï¼š

### 1. TypedDict é”®è®¿é—®

**å½±å“æ–‡ä»¶**:

- `research_assistant.py`
- `rag_assistant.py`
- `interrupt_agent.py`
- `knowledge_base_agent.py`

**ä½ç½®**: è®¿é—® State çš„å¯é€‰é”®ï¼ˆ`remaining_steps`, `safety` ç­‰ï¼‰

**å»ºè®®**: å‡çº§åˆ° `strict` æ—¶ä½¿ç”¨ `.get()` æ–¹æ³•

### 2. RunnableConfig è®¿é—®

**å½±å“æ–‡ä»¶**: å¤šä¸ª Agent æ–‡ä»¶

**ä½ç½®**:

```python
config["configurable"].get("model", settings.DEFAULT_MODEL)
```

**çŠ¶æ€**: `standard` çº§åˆ«ä¸‹æ­£å¸¸ï¼Œ`strict` çº§åˆ«å¯èƒ½æŠ¥é”™ "configurable ä¸æ˜¯å¿…éœ€é”®"

**å»ºè®®**: ä½¿ç”¨ `.get("configurable", {}).get("model", ...)`

## å»ºè®®

### çŸ­æœŸï¼ˆå½“å‰ standard çº§åˆ«ï¼‰

âœ… **ä¿æŒç°çŠ¶** - ä»£ç è´¨é‡è‰¯å¥½ï¼Œæ— éœ€ä¿®æ”¹

### ä¸­æœŸï¼ˆå¦‚æœå‡çº§åˆ° strictï¼‰

éœ€è¦å¤„ç†ä»¥ä¸‹é—®é¢˜ï¼š

1. **TypedDict é”®è®¿é—®** - ä½¿ç”¨ `.get()` æ–¹æ³•
2. **å¯é€‰é…ç½®è®¿é—®** - æ·»åŠ é»˜è®¤å€¼å¤„ç†
3. **ç±»å‹æ–­è¨€** - åœ¨å¿…è¦æ—¶æ·»åŠ  `assert` æˆ– `cast()`

### é•¿æœŸï¼ˆæœ€ä½³å®è·µï¼‰

1. **æ·»åŠ å•å…ƒæµ‹è¯•** - éªŒè¯ç±»å‹æ­£ç¡®æ€§
2. **å¯ç”¨ strict æ¨¡å¼** - é€æ­¥æå‡ä»£ç è´¨é‡
3. **CI/CD é›†æˆ** - è‡ªåŠ¨åŒ–ç±»å‹æ£€æŸ¥

## æ€»ç»“

ğŸ‰ **agents/ ç›®å½•ä»£ç è´¨é‡ä¼˜ç§€ï¼Œæ—  linting é”™è¯¯ï¼**

è¿™å¾—ç›Šäºï¼š

1. æœ€è¿‘çš„æ—¶é—´æˆ³ç³»ç»Ÿå®æ–½ä¿è¯äº†æ–°ä»£ç è´¨é‡
2. ç°æœ‰ä»£ç æœ¬èº«è´¨é‡è¾ƒå¥½
3. `standard` ç±»å‹æ£€æŸ¥çº§åˆ«é€‚åˆå½“å‰å¼€å‘é˜¶æ®µ

**ä¸‹ä¸€æ­¥**: æ£€æŸ¥å…¶ä»–æ¨¡å—ï¼ˆservice, auth, core, schema ç­‰ï¼‰

---

**æ£€æŸ¥äºº**: AI Assistant  
**å®¡æ ¸çŠ¶æ€**: å¾…äººå·¥å®¡æ ¸
